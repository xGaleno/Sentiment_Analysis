<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de An√°lisis - Empresa</title>

    <!-- Estilos -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/empresa_analisis.css') }}">

    <!-- Chart.js y plugins -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>

    <!-- ====================================================
         ENCABEZADO DE LA P√ÅGINA
    ===================================================== -->
    <header class="header">
        <a href="{{ url_for('empresa_login') }}" class="back-arrow">‚Üê</a>
        <img src="{{ url_for('static', filename='Assets/Robot.png') }}" alt="Logo Diha" class="logo" />
        <span class="diha-text">Diha</span>

        <div class="button-group">
            <button id="refreshButton" class="logout-button">Actualizar Datos</button>
            <button id="exportCSVButton" class="logout-button">Exportar CSV</button>
            <button id="generatePDFButton" class="logout-button">Generar Reporte PDF</button>
            <button id="logoutButton" class="logout-button">Cerrar Sesi√≥n</button>
        </div>
    </header>

    <!-- ====================================================
         CONTENIDO PRINCIPAL
    ===================================================== -->
    <main>

        <!-- üéØ Filtros -->
        <section class="statistics-box">
            <h1>Estad√≠sticas</h1>
            <div class="year-filter">
                <button id="2023" class="selected">2023</button>
                <button id="2024" class="selected">2024</button>
                <button id="2025" class="selected">2025</button>
            </div>
        </section>

        <div class="age-filter-box">
            <div class="filter-bar">
                <div class="age-filter-buttons" id="ageFilterButtons">
                    <button class="age-filter-button selected" data-range="18-25">18-25</button>
                    <button class="age-filter-button selected" data-range="26-35">26-35</button>
                    <button class="age-filter-button selected" data-range="36-45">36-45</button>
                    <button class="age-filter-button selected" data-range="46-60">46-60</button>
                    <button class="age-filter-button selected" data-range="60+">60+</button>
                </div>
            </div>
        </div>        

        <div class="historial-layout">
            <div class="users-panel">
                <h2>Usuarios</h2>
                <table id="usersTable">
                    <thead>
                        <tr><th>Correo Electr√≥nico</th></tr>
                    </thead>                      
                    <tbody><!-- Carga din√°mica --></tbody>
                </table>
            </div>
            <div class="chat-panel">
                <h2>Historial de Chat</h2>
                <div id="chatHistoryContainer"><!-- Din√°mico --></div>
            </div>
        </div>

        <section class="charts-row">
            <div class="chart-container">
                <h2>Sentimiento Promedio por Intervalo de Tiempo</h2>
                <canvas id="averageSentimentChart"></canvas>
                <p>El "Sentimiento Promedio" muestra la tendencia general de los sentimientos a lo largo del tiempo.</p>
            </div>
            <div class="chart-container">
                <h2>Varianza del Sentimiento por Intervalo de Tiempo</h2>
                <canvas id="varianceSentimentChart"></canvas>
                <p>La "Varianza del Sentimiento" muestra la dispersi√≥n de los sentimientos, ayudando a identificar la consistencia del sentimiento en un periodo espec√≠fico.</p>
            </div>
        </section>

        <section class="charts-row">
            <div class="chart-container single-chart">
                <h2>Distribuci√≥n de Sentimientos</h2>
                <canvas id="sentimentDistributionChart"></canvas>
                <p>La "Distribuci√≥n de Sentimientos" muestra el porcentaje de comentarios positivos, neutros y negativos.</p>
            </div>
            <div class="chart-container single-chart">
                <h2>Tendencia de Comentarios Positivos</h2>
                <canvas id="nuevoGrafico"></canvas>
                <p>Este gr√°fico muestra la tendencia de los comentarios positivos a lo largo del tiempo, permitiendo a las empresas identificar periodos de mejora o deterioro en la percepci√≥n de sus clientes.</p>
            </div>
        </section>

        <section class="charts-row">
            <div class="chart-container single-chart">
                <h2>Usuarios Registrados por Rango de Edad</h2>
                <canvas id="tercerGrafico"></canvas>
                <p>Este gr√°fico muestra la cantidad de usuarios registrados clasificados por rangos de edad.</p>
            </div>
        </section>
    </main>

    <!-- ====================================================
         M√ìDULOS DE L√ìGICA JS IMPORTADOS
    ===================================================== -->
    <script type="module" src="{{ url_for('static', filename='js/charts.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/empresa_analisis.js') }}"></script>

    <!-- ====================================================
         MODULO DE ENVIOS DE CORREO
    ===================================================== -->

    <section class="charts-row">
        <div class="chart-container single-chart">
            <h2>üìß Log de Correos Enviados</h2>
            <table id="correoLogTable" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ccc;">Fecha</th>
                        <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ccc;">Destinatario</th>
                        <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ccc;">Asunto</th>
                        <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ccc;">Estado</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Estos datos se cargar√°n din√°micamente desde el backend -->
                    {% for correo in correos_enviados %}
                    <tr>
                        <td style="padding: 6px;">{{ correo.fecha }}</td>
                        <td style="padding: 6px;">{{ correo.destinatario }}</td>
                        <td style="padding: 6px;">{{ correo.asunto }}</td>
                        <td style="padding: 6px;">{{ correo.estado }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <p style="margin-top: 10px;">Este log muestra los correos enviados autom√°ticamente por el sistema como respuesta a los formularios de opini√≥n.</p>
        </div>
    </section>

</body>
</html>
